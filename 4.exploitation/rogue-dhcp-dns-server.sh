#!/bin/bash
if [ -z $5 ];then printf "\nSyntax: $0 <interface|eth0> <sip|172.16.19.1> <begin|101> <end|105> <file|/tmp/hosts>\n\n"
	else net=$(echo $2|awk -F. '{print $1"."$2"."$3}');
sysctl net.ipv4.ip_forward=1;sysctl -p
ifconfig $1 $2 netmask 255.255.255.0 up
route add -net $net.0 netmask 255.255.255.0 gw $2
iptables -A FORWARD -i $1 -j ACCEPT
iptables -t nat -A POSTROUTING -o $(ip route|grep default|head -1|awk '{printf $5}') -j MASQUERADE
dnsmasq -i $1 --keep-in-foreground --log-queries --dhcp-range=interface:$1,$net.$3,$net.$4,255.255.255.0,$net.255,900 --address=/$(cat $5|tr '\n' '/')$2
fi
